DROP TABLE IF EXISTS BOOK_HAS_STATISTIC
DROP TABLE IF EXISTS AUTHORS_ADDRESSES
DROP TABLE IF EXISTS BOOKS_AUTHORS
DROP TABLE IF EXISTS PUBLISHERS_ADDRESSES


DROP TABLE IF EXISTS STORE
DROP TABLE IF EXISTS LOGS
DROP TABLE IF EXISTS AUTHORS
DROP TABLE IF EXISTS BOOK_STATISTICS
DROP TABLE IF EXISTS ADDRESSES
DROP TABLE IF EXISTS BOOKS
DROP TABLE IF EXISTS SPECIALBOOKS
DROP TABLE IF EXISTS SCHOOLBOOKS
DROP TABLE IF EXISTS PUBLISHERS

CREATE TABLE PUBLISHERS (
    ID INT, 
    NAME NVARCHAR(50) UNIQUE, 
    PRIMARY KEY (ID)
)

CREATE TABLE AUTHORS(
    ID INT, 
    LASTNAME NVARCHAR(20),
    FIRSTNAME NVARCHAR(20),
    PRIMARY KEY (ID)

)

CREATE TABLE ADDRESSES(
    ID INT, 
    CITY NVARCHAR(100), 
    STREET NVARCHAR(100), 
    PRIMARY KEY(ID) 
)

CREATE TABLE BOOK_STATISTICS(
    ISBN VARCHAR(20), 
    SOLD INT,
    SOLD_AT DATE,
    PRIMARY KEY (ISBN)

)
CREATE TABLE BOOKS (
    ISBN VARCHAR(20), 
    TITLE NVARCHAR(100) NOT NULL, 
    PAGES SMALLINT CHECK (PAGES >= 0), 
    PRICE DECIMAL (5,2) CHECK (PRICE >= 0), 
    AVAILABLE BIT NOT NULL DEFAULT 0, 
    PUBLISHER_ID INT,
    PRIMARY KEY (ISBN),
    FOREIGN KEY (PUBLISHER_ID) REFERENCES PUBLISHERS(ID)
) 


CREATE TABLE STORE (
    CATEGORY NVARCHAR(20), 
    ITEM NVARCHAR(20), 
    STOCK INT CHECK (STOCK > 0), 
    PRIMARY KEY (CATEGORY, ITEM)
)

CREATE TABLE LOGS (
    LOG_MESSAGE VARCHAR(1024)
)


-- Links

CREATE TABLE BOOKS_AUTHORS(
    AUTHOR_ID INT,
    BOOK_ID VARCHAR(20),
    PRIMARY KEY(AUTHOR_ID, BOOK_ID),
    FOREIGN KEY(AUTHOR_ID) REFERENCES AUTHORS(ID),
    FOREIGN KEY(BOOK_ID) REFERENCES BOOKS(ISBN)
)

CREATE TABLE PUBLISHERS_ADDRESSES(
    PUBLISHER_ID INT,
    ADDRESS_ID INT,
    PRIMARY KEY(PUBLISHER_ID, ADDRESS_ID),
    FOREIGN KEY(PUBLISHER_ID) REFERENCES PUBLISHERS(ID),
    FOREIGN KEY(ADDRESS_ID) REFERENCES ADDRESSES(ID)
)

CREATE TABLE AUTHORS_ADDRESSES(
    AUTHOR_ID INT,
    ADDRESS_ID INT,
    PRIMARY KEY(AUTHOR_ID, ADDRESS_ID),
    FOREIGN KEY(AUTHOR_ID) REFERENCES AUTHORS(ID),
    FOREIGN KEY(ADDRESS_ID) REFERENCES ADDRESSES(ID)
)

CREATE TABLE BOOK_HAS_STATISTIC(
    BOOK_ID VARCHAR(20),
    STATISTIC_ID VARCHAR(20),
    PRIMARY KEY(BOOK_ID, STATISTIC_ID),
    FOREIGN KEY(BOOK_ID) REFERENCES BOOKS(ISBN),
    FOREIGN KEY(STATISTIC_ID) REFERENCES BOOK_STATISTICS(ISBN)
)

CREATE TABLE SPECIALBOOKS (
    ISBN VARCHAR(20), 
    TITLE NVARCHAR(100) NOT NULL, 
    PAGES SMALLINT CHECK (PAGES >= 0), 
    PRICE DECIMAL (5,2) CHECK (PRICE >= 0), 
    AVAILABLE BIT NOT NULL DEFAULT 0, 
    PUBLISHER_ID INT,
    SUBJECT NVARCHAR(200),
    PRIMARY KEY (ISBN),
    FOREIGN KEY (PUBLISHER_ID) REFERENCES PUBLISHERS(ID)
) 

CREATE TABLE SCHOOLBOOKS (
    ISBN VARCHAR(20), 
    TITLE NVARCHAR(100) NOT NULL, 
    PAGES SMALLINT CHECK (PAGES >= 0), 
    PRICE DECIMAL (5,2) CHECK (PRICE >= 0), 
    AVAILABLE BIT NOT NULL DEFAULT 0, 
    PUBLISHER_ID INT,
    TOPIC NVARCHAR(200),
    YEAR INT,
    PRIMARY KEY (ISBN),
    FOREIGN KEY (PUBLISHER_ID) REFERENCES PUBLISHERS(ID)
) 
